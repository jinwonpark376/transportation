{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "title": "üöÄ Application Overview",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "collapsed": false
    },
    {
      "title": "Request Rate (RPS)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 1 },
      "targets": [
        {
          "expr": "rate(http_server_requests_seconds_count{uri=~\"/api/.*\"}[1m])",
          "legendFormat": "{{method}} {{uri}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "reqps"
        }
      }
    },
    {
      "title": "Response Time (p99)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 1 },
      "targets": [
        {
          "expr": "histogram_quantile(0.99, rate(http_server_requests_seconds_bucket{uri=~\"/api/.*\"}[1m]))",
          "legendFormat": "p99 {{uri}}"
        },
        {
          "expr": "histogram_quantile(0.95, rate(http_server_requests_seconds_bucket{uri=~\"/api/.*\"}[1m]))",
          "legendFormat": "p95 {{uri}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        }
      }
    },
    {
      "title": "Error Rate",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 1 },
      "targets": [
        {
          "expr": "rate(http_server_requests_seconds_count{status=~\"5..\"}[1m]) / rate(http_server_requests_seconds_count[1m]) * 100",
          "legendFormat": "Error %"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "max": 100
        }
      }
    },
    {
      "title": "üóÑÔ∏è Database (HikariCP)",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 9 },
      "collapsed": false
    },
    {
      "title": "Connection Pool - Active vs Idle",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 10 },
      "targets": [
        {
          "expr": "hikaricp_connections_active",
          "legendFormat": "Active"
        },
        {
          "expr": "hikaricp_connections_idle",
          "legendFormat": "Idle"
        },
        {
          "expr": "hikaricp_connections_max",
          "legendFormat": "Max"
        }
      ]
    },
    {
      "title": "Connection Acquire Time",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 10 },
      "targets": [
        {
          "expr": "hikaricp_connections_acquire_seconds_max",
          "legendFormat": "Max Acquire Time"
        },
        {
          "expr": "rate(hikaricp_connections_acquire_seconds_sum[1m]) / rate(hikaricp_connections_acquire_seconds_count[1m])",
          "legendFormat": "Avg Acquire Time"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        }
      }
    },
    {
      "title": "Pending Connection Requests",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 10 },
      "targets": [
        {
          "expr": "hikaricp_connections_pending",
          "legendFormat": "Pending"
        },
        {
          "expr": "hikaricp_connections_timeout_total",
          "legendFormat": "Timeouts (cumulative)"
        }
      ]
    },
    {
      "title": "üìä MySQL Performance",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 18 },
      "collapsed": false
    },
    {
      "title": "MySQL Queries Per Second",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 19 },
      "targets": [
        {
          "expr": "rate(mysql_global_status_queries[1m])",
          "legendFormat": "QPS"
        }
      ]
    },
    {
      "title": "MySQL Connections",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 19 },
      "targets": [
        {
          "expr": "mysql_global_status_threads_connected",
          "legendFormat": "Connected"
        },
        {
          "expr": "mysql_global_status_threads_running",
          "legendFormat": "Running"
        },
        {
          "expr": "mysql_global_variables_max_connections",
          "legendFormat": "Max"
        }
      ]
    },
    {
      "title": "MySQL Slow Queries",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 19 },
      "targets": [
        {
          "expr": "rate(mysql_global_status_slow_queries[1m])",
          "legendFormat": "Slow Queries/s"
        }
      ]
    },
    {
      "title": "üî¥ Redis Performance",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 27 },
      "collapsed": false
    },
    {
      "title": "Redis Commands/sec",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 28 },
      "targets": [
        {
          "expr": "rate(redis_commands_processed_total[1m])",
          "legendFormat": "Commands/s"
        }
      ]
    },
    {
      "title": "Redis Memory Usage",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 28 },
      "targets": [
        {
          "expr": "redis_memory_used_bytes",
          "legendFormat": "Used"
        },
        {
          "expr": "redis_memory_max_bytes",
          "legendFormat": "Max"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "bytes"
        }
      }
    },
    {
      "title": "Redis Connected Clients",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 28 },
      "targets": [
        {
          "expr": "redis_connected_clients",
          "legendFormat": "Clients"
        }
      ]
    },
    {
      "title": "‚ö° Custom Metrics (Rate Limiter)",
      "type": "row",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 36 },
      "collapsed": false
    },
    {
      "title": "Reservation TPS",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 37 },
      "targets": [
        {
          "expr": "rate(reservation_create_total[1m])",
          "legendFormat": "Success/s"
        },
        {
          "expr": "rate(reservation_create_failed_total[1m])",
          "legendFormat": "Failed/s"
        }
      ]
    },
    {
      "title": "Lock Acquisition Time",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 37 },
      "targets": [
        {
          "expr": "histogram_quantile(0.99, rate(lock_acquire_seconds_bucket[1m]))",
          "legendFormat": "p99"
        },
        {
          "expr": "histogram_quantile(0.50, rate(lock_acquire_seconds_bucket[1m]))",
          "legendFormat": "p50"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        }
      }
    },
    {
      "title": "Rate Limit Rejections",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 37 },
      "targets": [
        {
          "expr": "rate(rate_limit_rejected_total{type=\"local\"}[1m])",
          "legendFormat": "Local Semaphore"
        },
        {
          "expr": "rate(rate_limit_rejected_total{type=\"distributed\"}[1m])",
          "legendFormat": "Redis Distributed"
        }
      ]
    }
  ],
  "refresh": "5s",
  "schemaVersion": 38,
  "tags": ["transportation", "spring-boot"],
  "templating": { "list": [] },
  "time": { "from": "now-15m", "to": "now" },
  "timepicker": {},
  "timezone": "browser",
  "title": "Transportation - Performance Overview",
  "uid": "transportation-overview",
  "version": 1
}

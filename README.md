# ğŸš Transportation Service

> ì‹¤ì‹œê°„ êµí†µ ì˜ˆì•½ ì„œë¹„ìŠ¤ì˜ **ë™ì‹œì„± ì œì–´**ì™€ **ê³ ì„±ëŠ¥ ì²˜ë¦¬**ë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•œ í”„ë¡œì íŠ¸

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

ì•„ì‹œì•ˆê²Œì„ê³¼ ê°™ì€ ëŒ€ê·œëª¨ êµ­ì œ í–‰ì‚¬ì—ì„œ VIP/ì„ ìˆ˜ë‹¨ ì´ë™ì„ ìœ„í•œ ì°¨ëŸ‰ ì˜ˆì•½ ì‹œìŠ¤í…œì„ ëª¨ë¸ë§í–ˆìŠµë‹ˆë‹¤. 
ë™ì¼í•œ ì°¨ëŸ‰/ë””ìŠ¤íŒ¨ì²˜ì— ëŒ€í•´ ë™ì‹œì— ì—¬ëŸ¬ ì˜ˆì•½ ìš”ì²­ì´ ë°œìƒí•˜ëŠ” **Race Condition** ìƒí™©ì—ì„œ 
**ë°ì´í„° ì •í•©ì„±**ì„ ë³´ì¥í•˜ë©´ì„œ **ë†’ì€ ì²˜ë¦¬ëŸ‰(TPS)**ì„ ë‹¬ì„±í•˜ëŠ” ê²ƒì´ í•µì‹¬ ëª©í‘œì…ë‹ˆë‹¤.

### ğŸ¯ í•µì‹¬ ë„ì „ ê³¼ì œ

1. **ë™ì‹œì„± ë¬¸ì œ**: 10ê°œ ì´ìƒì˜ ë™ì‹œ ìš”ì²­ ì¤‘ ì˜¤ì§ 1ê°œë§Œ ì„±ê³µí•´ì•¼ í•¨
2. **ì‹œê°„ ê²¹ì¹¨ ê²€ì¦**: ê¸°ì¡´ ì˜ˆì•½ê³¼ ì‹œê°„ì´ ê²¹ì¹˜ëŠ” ì˜ˆì•½ ì°¨ë‹¨
3. **ìœ„ì¹˜ ì—°ì†ì„± ê²€ì¦**: ì°¨ëŸ‰/ë””ìŠ¤íŒ¨ì²˜ì˜ ì´ì „ ë„ì°©ì§€ = ë‹¤ìŒ ì¶œë°œì§€
4. **ê³ ì„±ëŠ¥**: ë…ë¦½ì ì¸ ì˜ˆì•½ì€ ìµœëŒ€ **30,000+ TPS** ì²˜ë¦¬
5. **DB ë¶€í•˜ ë³´í˜¸**: íŠ¸ë˜í”½ ìŠ¤íŒŒì´í¬ ì‹œì—ë„ DB ë¶€í•˜ ìµœì†Œí™”

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

### ì „ì²´ ìš”ì²­ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ReservationController                           â”‚
â”‚                       POST /api/reservations                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ReservationService                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Layer 1: Local Semaphore (ì„œë²„ë³„ í•„í„°ë§)                      â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚  â”‚
â”‚  â”‚  â€¢ 1ì‹œê°„ ë‹¨ìœ„ ìŠ¬ë¡¯ë³„ Semaphoreë¡œ ë™ì‹œ ìš”ì²­ ì œì–´                 â”‚  â”‚
â”‚  â”‚  â€¢ 1000ê°œ ìš”ì²­ â†’ ì„œë²„ë‹¹ 1ê°œë§Œ í†µê³¼                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚                                   â”‚
â”‚                                  â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Layer 2: Redis ë¶„ì‚° ë½ (ì „ì—­ ì¡°ìœ¨) - Redisson                 â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚  â”‚
â”‚  â”‚  â€¢ ì—¬ëŸ¬ ì„œë²„ ê°„ ë™ê¸°í™”                                         â”‚  â”‚
â”‚  â”‚  â€¢ Watchdogìœ¼ë¡œ TTL ìë™ ì—°ì¥                                  â”‚  â”‚
â”‚  â”‚  â€¢ Circuit Breakerë¡œ ì¥ì•  ëŒ€ì‘                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚                                   â”‚
â”‚                                  â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Layer 3: DB ì„ ì  í›„ ê²€ì¦ (ìµœì¢… ì •í•©ì„±)                        â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚  â”‚
â”‚  â”‚  â€¢ INSERT + COMMIT â†’ Overlap ê²€ì¦ â†’ ì‹¤íŒ¨ ì‹œ DELETE             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë ˆì´ì–´ë“œ ë°©ì–´ íš¨ê³¼

```
1000ê°œ ìš”ì²­ (ë™ì¼ ì°¨ëŸ‰, ë™ì¼ ì‹œê°„ëŒ€, ì„œë²„ 10ëŒ€)
  â”‚
  â–¼
Layer 1: Local Semaphore
  â”‚ 1000ê°œ â†’ 10ê°œ (99% í•„í„°ë§)
  â–¼
Layer 2: Redis ë¶„ì‚° ë½  
  â”‚ 10ê°œ â†’ 1ê°œ (ìµœì¢… 1ê°œ ë³´ì¥)
  â–¼
Layer 3: DB ì„ ì  í›„ ê²€ì¦
  â”‚ 1ê°œ â†’ ì •í•©ì„± ë³´ì¥
  â–¼
âœ… ì˜ˆì•½ ì„±ê³µ
```

| êµ¬ì„± | DB ì ‘ê·¼ | Redis ì ‘ê·¼ | íš¨ê³¼ |
|------|--------|-----------|------|
| Layer 3ë§Œ | 1000 | - | ê¸°ë³¸ |
| Layer 1+3 (10ëŒ€) | 10 | - | 99% ê°ì†Œ |
| Layer 1+2+3 | 1 | 10 | 99.9% ê°ì†Œ |

---

## ğŸ” Rate Limiting & ë¶„ì‚° ë½

### Layer 1: Local Semaphore

JVM ë‚´ì—ì„œ ë™ì¼ ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ë™ì‹œ ìš”ì²­ì„ ì œì–´í•©ë‹ˆë‹¤.

```java
// ìŠ¬ë¡¯ í‚¤ ìƒì„±: ì°¨ëŸ‰ID + ë‚ ì§œ + ì‹œê°„ëŒ€
// ì˜ˆ: VEHICLE_1_2026-01-29_SLOT_09

Semaphore semaphore = semaphores.computeIfAbsent(key, k -> new Semaphore(1));
if (!semaphore.tryAcquire()) {
    throw new RateLimitExceededException("ì´ë¯¸ ì²˜ë¦¬ ì¤‘ì¸ ìš”ì²­ì´ ìˆìŠµë‹ˆë‹¤");
}
```

**íŠ¹ì§•:**
- `ConcurrentHashMap`ìœ¼ë¡œ ìŠ¬ë¡¯ë³„ Semaphore ê´€ë¦¬
- `tryAcquire()`: ë…¼ë¸”ë¡œí‚¹, ì¦‰ì‹œ ì„±ê³µ/ì‹¤íŒ¨ íŒë‹¨
- 1ì‹œê°„ ë‹¨ìœ„ ìŠ¬ë¡¯ìœ¼ë¡œ ì‹œê°„ ê²¹ì¹¨ ìš”ì²­ ì œì–´
- ì„œë²„ ì¬ì‹œì‘ ì‹œ ìë™ ì´ˆê¸°í™”

### Layer 2: Redis ë¶„ì‚° ë½ (Redisson)

ì—¬ëŸ¬ ì„œë²„ ê°„ ë™ê¸°í™”ë¥¼ ìœ„í•´ Redisson RLockì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

```java
RLock lock = redissonClient.getLock(lockKey);
boolean acquired = lock.tryLock(
    0,   // waitTime: ëŒ€ê¸° ì•ˆ í•¨ (ì¦‰ì‹œ ì‹¤íŒ¨)
    -1,  // leaseTime: Watchdog í™œì„±í™” (ìë™ TTL ì—°ì¥)
    TimeUnit.SECONDS
);
```

**Redisson RLockì˜ ì¥ì :**

| ê¸°ëŠ¥ | ì§ì ‘ êµ¬í˜„ | Redisson |
|------|----------|----------|
| ë½ íšë“ | `SETNX + TTL` | `tryLock()` |
| ë½ í•´ì œ | Lua ìŠ¤í¬ë¦½íŠ¸ í•„ìš” | `unlock()` (ìë™ ì•ˆì „ ì²˜ë¦¬) |
| TTL ì—°ì¥ | ì§ì ‘ êµ¬í˜„ í•„ìš” | **Watchdog ìë™ ì—°ì¥** |
| ì¬ì§„ì… | ë¶ˆê°€ | ì§€ì› |
| ì•ˆì „ì„± | ìˆ˜ë™ ê²€ì¦ í•„ìš” | ê²€ì¦ëœ í”„ë¡œë•ì…˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ |

**Watchdog ë™ì‘:**
```
0ì´ˆ   ë½ íšë“ (ê¸°ë³¸ TTL 30ì´ˆ)
â”‚
10ì´ˆ  Watchdogì´ TTL ì—°ì¥ â†’ 30ì´ˆ ë¦¬ì…‹
â”‚
20ì´ˆ  Watchdogì´ TTL ì—°ì¥ â†’ 30ì´ˆ ë¦¬ì…‹
â”‚
35ì´ˆ  ì‘ì—… ì™„ë£Œ â†’ unlock() â†’ Watchdog ì¤‘ë‹¨
```
- ì‘ì—… ì¤‘ì—ëŠ” ë½ ìœ ì§€, ì„œë²„ ì£½ìœ¼ë©´ TTL ë§Œë£Œë¡œ ìë™ í•´ì œ

### Circuit Breaker (Redis ì¥ì•  ëŒ€ì‘)

Redis ì¥ì•  ì‹œì—ë„ ì„œë¹„ìŠ¤ ì—°ì†ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Circuit Breaker ìƒíƒœ ì „ì´                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  CLOSED (ì •ìƒ)                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚  ìš”ì²­ â†’ Redis ì‚¬ìš© â†’ ì„±ê³µ/ì‹¤íŒ¨ ì¹´ìš´íŠ¸                            â”‚
â”‚                                                                 â”‚
â”‚  ì—°ì† 5íšŒ ì‹¤íŒ¨ ì‹œ â†’ OPEN                                         â”‚
â”‚                                                                 â”‚
â”‚  OPEN (ì°¨ë‹¨) - 30ì´ˆê°„                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚  ìš”ì²­ â†’ Redis ìŠ¤í‚µ â†’ Local Semaphoreë§Œìœ¼ë¡œ ë™ì‘ (Fallback)       â”‚
â”‚                                                                 â”‚
â”‚  30ì´ˆ í›„ â†’ HALF_OPEN                                             â”‚
â”‚                                                                 â”‚
â”‚  HALF_OPEN (ë³µêµ¬ ì‹œë„)                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚  ì¼ë¶€ ìš”ì²­ë§Œ Redis ì‹œë„                                          â”‚
â”‚  â†’ 3íšŒ ì—°ì† ì„±ê³µ ì‹œ CLOSED ë³µê·€                                   â”‚
â”‚  â†’ ì‹¤íŒ¨ ì‹œ ë‹¤ì‹œ OPEN                                             â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ í•µì‹¬ ë™ì‹œì„± ì „ëµ: "ì„ ì  í›„ ê²€ì¦" íŒ¨í„´

### ë¬¸ì œ ìƒí™©

```
Thread A: ê²€ì¦ â†’ (í†µê³¼) â†’ INSERT
Thread B: ê²€ì¦ â†’ (í†µê³¼) â†’ INSERT   â† ë‘˜ ë‹¤ ì„±ê³µí•˜ë©´ ì•ˆë¨!
```

ê¸°ì¡´ì˜ "ê²€ì¦ í›„ ì‚½ì…" ë°©ì‹ì€ ê²€ì¦ê³¼ ì‚½ì… ì‚¬ì´ì˜ Gapì—ì„œ Race Condition ë°œìƒ

### í•´ê²° ë°©ë²•

```
Thread A: INSERT(ID=1) â†’ COMMIT â†’ Overlapê²€ì¦(ID<1 ì—†ìŒ) â†’ ì„±ê³µ
Thread B: INSERT(ID=2) â†’ COMMIT â†’ Overlapê²€ì¦(ID<2 ìˆìŒ=ID:1) â†’ ì‹¤íŒ¨ â†’ DELETE
```

1. **ë¨¼ì € INSERTí•˜ê³  ì¦‰ì‹œ COMMIT** (`REQUIRES_NEW` íŠ¸ëœì­ì…˜)
2. **ìì‹ ë³´ë‹¤ ë¨¼ì € INSERTëœ ì˜ˆì•½**(`id < excludeId`)ê³¼ Overlap ê²€ì¦
3. ì‹¤íŒ¨ ì‹œ **ìì‹ ì˜ ì˜ˆì•½ ì‚­ì œ**

### ì™œ ì´ ë°©ì‹ì¸ê°€?

| ë°©ì‹ | ì¥ì  | ë‹¨ì  |
|------|------|------|
| **ë¹„ê´€ì  ë½** | í™•ì‹¤í•œ ë³´ì¥ | ë½ ê²½í•©ìœ¼ë¡œ ì„±ëŠ¥ ì €í•˜ |
| **ë‚™ê´€ì  ë½** | ë†’ì€ ë™ì‹œì„± | ì¶©ëŒ ì‹œ ì¬ì‹œë„ í•„ìš” |
| **ì„ ì  í›„ ê²€ì¦** âœ… | DB ë ˆë²¨ ì›ìì„± ë³´ì¥, ì¬ì‹œë„ ë¶ˆí•„ìš” | ì‹¤íŒ¨ ì‹œ DELETE ë¹„ìš© |

### Rate Limitingì˜ ì—­í• 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Rate Limitingì´ í•´ê²°í•˜ëŠ” ë¬¸ì œ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Rate Limiting ì—†ì´:                                             â”‚
â”‚  1000ê°œ ìš”ì²­ â†’ 1000ê°œ INSERT â†’ 999ê°œ DELETE                      â”‚
â”‚  â†’ ë¶ˆí•„ìš”í•œ DB ë¶€í•˜ ë°œìƒ                                         â”‚
â”‚                                                                 â”‚
â”‚  Rate Limiting ì ìš© í›„:                                          â”‚
â”‚  1000ê°œ ìš”ì²­ â†’ 1ê°œë§Œ INSERT â†’ ì„±ê³µ                               â”‚
â”‚  â†’ ë‚˜ë¨¸ì§€ 999ê°œëŠ” ì¦‰ì‹œ ì‹¤íŒ¨ ì‘ë‹µ (DB ì ‘ê·¼ ì—†ìŒ)                   â”‚
â”‚                                                                 â”‚
â”‚  í•µì‹¬: ì •í•©ì„±ì€ DBê°€ ë³´ì¥, Rate Limitingì€ ë¶€í•˜ ìµœì í™”            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/
â”œâ”€â”€ main/java/com/resume/transportation/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ RedissonConfig.java             # Redisson í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
â”‚   â”‚
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â””â”€â”€ ReservationController.java      # REST API ì—”ë“œí¬ì¸íŠ¸
â”‚   â”‚
â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”œâ”€â”€ Reservation.java                # ì˜ˆì•½ (ë‚™ê´€ì  ë½ @Version)
â”‚   â”‚   â”œâ”€â”€ Vehicle.java                    # ì°¨ëŸ‰
â”‚   â”‚   â””â”€â”€ User.java                       # ìš´ì˜ì/ë””ìŠ¤íŒ¨ì²˜
â”‚   â”‚
â”‚   â”œâ”€â”€ enums/
â”‚   â”‚   â”œâ”€â”€ Location.java                   # ì¥ì†Œ (ê³µí•­, í˜¸í…”, ê²½ê¸°ì¥ ë“±)
â”‚   â”‚   â”œâ”€â”€ ReservationStatus.java          # CREATED, IN_PROGRESS, DONE
â”‚   â”‚   â”œâ”€â”€ VehicleStatus.java              # IDLE, MOVING
â”‚   â”‚   â””â”€â”€ UserRole.java                   # OPERATOR, VOLUNTEER
â”‚   â”‚
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ ReservationRepository.java      # Overlap ê²€ì¦ ì¿¼ë¦¬
â”‚   â”‚   â”œâ”€â”€ VehicleRepository.java
â”‚   â”‚   â””â”€â”€ UserRepository.java
â”‚   â”‚
â”‚   â””â”€â”€ service/
â”‚       â”œâ”€â”€ ReservationService.java         # ì˜ˆì•½ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚       â”œâ”€â”€ ReservationPersistenceService.java  # REQUIRES_NEW íŠ¸ëœì­ì…˜
â”‚       â”œâ”€â”€ TravelTimeService.java          # ì´ë™ ì‹œê°„ ê³„ì‚°
â”‚       â”œâ”€â”€ command/
â”‚       â”‚   â””â”€â”€ CreateReservationCommand.java
â”‚       â”œâ”€â”€ ratelimit/
â”‚       â”‚   â”œâ”€â”€ ResourceRateLimiter.java    # Local Semaphore ê¸°ë°˜
â”‚       â”‚   â”œâ”€â”€ DistributedRateLimiter.java # Redisson ë¶„ì‚° ë½
â”‚       â”‚   â”œâ”€â”€ CompositeRateLimiter.java   # Layer 1+2 ì¡°í•©
â”‚       â”‚   â”œâ”€â”€ CircuitBreaker.java         # Redis ì¥ì•  ëŒ€ì‘
â”‚       â”‚   â””â”€â”€ RateLimitExceededException.java
â”‚       â””â”€â”€ support/
â”‚           â””â”€â”€ LocationPair.java
â”‚
â””â”€â”€ test/java/com/resume/transportation/
    â”œâ”€â”€ concurrency/
    â”‚   â””â”€â”€ OptimisticLockConcurrencyTest.java
    â”œâ”€â”€ ratelimit/
    â”‚   â”œâ”€â”€ ResourceRateLimiterTest.java    # Semaphore í…ŒìŠ¤íŠ¸
    â”‚   â”œâ”€â”€ DistributedRateLimiterTest.java # Redisson í…ŒìŠ¤íŠ¸
    â”‚   â”œâ”€â”€ CircuitBreakerTest.java         # Circuit Breaker í…ŒìŠ¤íŠ¸
    â”‚   â””â”€â”€ EmbeddedRedisConfig.java        # í…ŒìŠ¤íŠ¸ìš© Redis
    â””â”€â”€ repository/
        â””â”€â”€ OverlapLogicTest.java
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. Rate Limiting í…ŒìŠ¤íŠ¸

#### Local Semaphore í…ŒìŠ¤íŠ¸
```java
@Test
@DisplayName("ë™ì‹œì— 100ê°œ ìš”ì²­ ì‹œ 1ê°œë§Œ permit íšë“")
void onlyOneAcquiresUnderConcurrency()
```
- **ì‹œë‚˜ë¦¬ì˜¤**: 100ê°œ ìŠ¤ë ˆë“œê°€ ë™ì¼ ìŠ¬ë¡¯ì— ë™ì‹œ ìš”ì²­
- **ê¸°ëŒ€ ê²°ê³¼**: 1ê°œ ì„±ê³µ, 99ê°œ ì‹¤íŒ¨
- **ê²€ì¦**: `assertThat(successCount.get()).isEqualTo(1)`

#### Redis ë¶„ì‚° ë½ í…ŒìŠ¤íŠ¸
```java
@Test
@DisplayName("ë™ì‹œì— 100ê°œ ìš”ì²­ ì‹œ 1ê°œë§Œ ì„±ê³µ (ë¶„ì‚° í™˜ê²½)")
void onlyOneSucceedsUnderConcurrency()
```
- **ê²°ê³¼**: `Redisson ë¶„ì‚° ë½ í…ŒìŠ¤íŠ¸ - ì„±ê³µ: 1, ì‹¤íŒ¨: 99`

#### Circuit Breaker í…ŒìŠ¤íŠ¸
```java
@Test
@DisplayName("ì—°ì† ì‹¤íŒ¨ ì‹œ OPENìœ¼ë¡œ ì „ì´")
void opensAfterThresholdFailures()

@Test
@DisplayName("HALF_OPENì—ì„œ ì„±ê³µ ì‹œ CLOSED ë³µê·€")
void closesAfterSuccessesInHalfOpen()
```

### 2. ë™ì‹œì„± í…ŒìŠ¤íŠ¸ (OptimisticLockConcurrencyTest)

#### í…ŒìŠ¤íŠ¸ 1: ë™ì¼ ì‹œê°„ëŒ€ ë™ì‹œ ì˜ˆì•½
```java
@Test
@DisplayName("ë™ì‹œì— ê°™ì€ ì°¨ëŸ‰, ê°™ì€ ì‹œê°„ëŒ€ ì˜ˆì•½ ì‹œ í•˜ë‚˜ë§Œ ì„±ê³µí•´ì•¼ í•œë‹¤")
void testConcurrentReservationWithInsertThenValidate()
```
- **ì‹œë‚˜ë¦¬ì˜¤**: 10ê°œ ìŠ¤ë ˆë“œê°€ ë™ì‹œì— ë™ì¼ ì°¨ëŸ‰, ë™ì¼ ì‹œê°„ëŒ€ ì˜ˆì•½
- **ê¸°ëŒ€ ê²°ê³¼**: ì„±ê³µ 1ê±´, ì‹¤íŒ¨ 9ê±´

### 3. ë¶€í•˜ í…ŒìŠ¤íŠ¸ ê²°ê³¼

| ë¶€í•˜ (ê±´) | ì„±ê³µ | ì‹¤íŒ¨ | ì†Œìš”ì‹œê°„ | TPS | í‰ê·  ì‘ë‹µì‹œê°„ |
|-----------|------|------|----------|-----|--------------|
| 100 | 100 | 0 | 106ms | **943** | 1.06ms |
| 1,000 | 1,000 | 0 | 192ms | **5,208** | 0.19ms |
| 10,000 | 10,000 | 0 | 793ms | **12,610** | 0.08ms |
| 500,000 | 500,000 | 0 | 16,230ms | **30,807** | 0.03ms |

> âœ… **50ë§Œ ê±´ ë™ì‹œ ìš”ì²­ì—ì„œë„ ì—ëŸ¬ìœ¨ 0%, TPS 30,000+ ë‹¬ì„±**

---

## ğŸ—ƒï¸ ë°ì´í„° ëª¨ë¸

### Reservation (ì˜ˆì•½)

```java
@Entity
public class Reservation {
    @Id @GeneratedValue
    private Long id;
    
    @ManyToOne private Vehicle vehicle;
    @ManyToOne private User dispatcher;
    @ManyToOne private User operator;
    
    @Enumerated private Location fromLocation;
    @Enumerated private Location toLocation;
    @Enumerated private ReservationStatus status;
    
    private LocalDateTime startTime;
    private LocalDateTime endTime;
    
    @Version
    private Long version;  // ë‚™ê´€ì  ë½
}
```

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### ìš”êµ¬ì‚¬í•­
- Java 21+
- Gradle 9.2+
- Redis 6.0+ (ë¶„ì‚° ë½ í…ŒìŠ¤íŠ¸ ì‹œ)

### í…ŒìŠ¤íŠ¸ ì‹¤í–‰

```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸
./gradlew test

# Rate Limiting í…ŒìŠ¤íŠ¸
./gradlew test --tests "*RateLimiterTest*"

# Circuit Breaker í…ŒìŠ¤íŠ¸
./gradlew test --tests "*CircuitBreakerTest*"

# ë™ì‹œì„± í…ŒìŠ¤íŠ¸
./gradlew test --tests "*ConcurrencyTest*"
```

---

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

| êµ¬ë¶„ | ê¸°ìˆ  |
|------|------|
| Language | Java 21 |
| Framework | Spring Boot 4.0 |
| ORM | Spring Data JPA |
| Database | H2 (In-Memory) |
| Cache/Lock | Redis + Redisson |
| Build | Gradle Kotlin DSL |
| Test | JUnit 5, AssertJ, Embedded Redis |

---

## ğŸ“š í•™ìŠµ í¬ì¸íŠ¸

1. **ì„ ì  í›„ ê²€ì¦ íŒ¨í„´**: ë½ ì—†ì´ DB ë ˆë²¨ ë™ì‹œì„± ì œì–´
2. **ë ˆì´ì–´ë“œ ë°©ì–´ ì „ëµ**: Semaphore â†’ Redis â†’ DB ìˆœì°¨ í•„í„°ë§
3. **Semaphore vs Lock**: ë™ì‹œ ì ‘ê·¼ ìˆ˜ ì œí•œ vs ìƒí˜¸ ë°°ì œ
4. **Redisson RLock**: Watchdog ìë™ TTL ì—°ì¥, ì•ˆì „í•œ ë½ í•´ì œ
5. **Circuit Breaker**: ì¥ì•  ì „íŒŒ ë°©ì§€, Fallback ì²˜ë¦¬
6. **ConcurrentHashMap**: ìŠ¤ë ˆë“œ ì•ˆì „í•œ ìŠ¬ë¡¯ ê´€ë¦¬

---

## ğŸ“ License

This project is for portfolio purposes.
